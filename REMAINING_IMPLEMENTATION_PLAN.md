# 剩余功能实现计划

## 当前状态
- ✅ 核心语法: 85%
- ✅ 面向对象: 60%
- ✅ 魔术方法: 85%
- ✅ 总体: 75%

## 高优先级功能实现顺序

### 1. __le__ 和 __ge__ 魔术方法 ⭐ 最简单
**难度**: 简单 (30分钟)
**方法**: 
- 当前 `<=` 编译为 `OP_GREATER + OP_NOT`
- 当前 `>=` 编译为 `OP_LESS + OP_NOT`
- 需要添加 `OP_LESS_EQUAL` 和 `OP_GREATER_EQUAL` 操作码
- 在这些操作码中检查 `__le__` 和 `__ge__` 魔术方法

**实现步骤**:
1. 在 vm.h 中添加 OP_LESS_EQUAL 和 OP_GREATER_EQUAL
2. 在 parser.c 中修改编译逻辑
3. 在 vm.c 中实现这两个操作码，支持魔术方法
4. 测试

### 2. 字典推导式 ⭐ 中等
**难度**: 中等 (1-2小时)
**方法**:
- 基于现有的列表推导式实现
- 语法: `{key_expr: value_expr for var in iterable}`
- 需要新的操作码 OP_BUILD_DICT_COMP

**实现步骤**:
1. 在 vm.h 中添加 OP_BUILD_DICT_COMP
2. 在 parser.c 中识别字典推导式语法
3. 在 vm.c 中实现字典推导式逻辑
4. 测试

### 3. __contains__ 魔术方法 ⭐ 简单
**难度**: 简单 (30分钟)
**方法**:
- 在 OP_IN 操作码中添加 `__contains__` 支持
- 语法: `item in container`

**实现步骤**:
1. 找到 OP_IN 的实现
2. 添加实例对象检查和 __contains__ 调用
3. 测试

### 4. Set类型 ⭐⭐ 复杂
**难度**: 复杂 (3-4小时)
**方法**:
- 需要新的数据结构 ms_set_t
- 需要实现集合操作（add, remove, union, intersection等）
- 需要 set() 内置函数
- 需要集合推导式

**实现步骤**:
1. 在 value.h 中定义 MS_VAL_SET 和 ms_set_t
2. 在 core/ 中实现 set.c 和 set.h
3. 实现 set 操作函数
4. 添加 set() 内置函数
5. 实现集合推导式（类似字典推导式）
6. 测试

### 5. 装饰器系统 ⭐⭐⭐ 最复杂
**难度**: 非常复杂 (4-6小时)
**方法**:
- 需要在解析器中识别 @ 语法
- 需要在函数/方法定义后应用装饰器
- @property 需要特殊处理（getter/setter）
- @classmethod 和 @staticmethod 需要特殊的函数类型

**实现步骤**:
1. 在 parser.c 中解析装饰器语法
2. 实现装饰器应用机制
3. 实现内置装饰器（property, classmethod, staticmethod）
4. 测试

## 实现优先级建议

### 今天可以完成（2-3小时）
1. ✅ __le__ 和 __ge__ (30分钟)
2. ✅ __contains__ (30分钟)
3. ✅ 字典推导式 (1-2小时)

### 明天可以完成（3-4小时）
4. Set类型基础 (3-4小时)

### 后续完成（4-6小时）
5. 装饰器系统 (4-6小时)

## 快速实现路径

如果时间有限，建议按以下顺序实现：

1. **__le__ 和 __ge__** - 30分钟，立即提升魔术方法完成度到92%
2. **__contains__** - 30分钟，提升到100%
3. **字典推导式** - 1小时，用户常用功能
4. **Set类型** - 3小时，完整的数据结构支持
5. **装饰器** - 4小时，高级特性

总计约9小时可以完成所有高优先级功能！

## 中优先级功能

### 海象运算符完整实现
**难度**: 中等 (1-2小时)
**当前状态**: 词法分析器支持，解析器部分实现
**需要**: 完善表达式中的赋值逻辑

### __iter__ 和 __next__
**难度**: 复杂 (2-3小时)
**需要**: 迭代器协议支持，可能需要修改 for 循环实现

## 低优先级功能

这些功能虽然重要，但不影响核心功能使用：
- 异常处理 (try/except/finally)
- with 语句
- yield 和生成器
- async/await

## 总结

通过实现高优先级功能，可以将总体完成度从75%提升到90%以上！

最快路径：
- 1小时内: 实现 __le__, __ge__, __contains__ → 80%完成度
- 3小时内: 加上字典推导式 → 85%完成度
- 6小时内: 加上Set类型 → 90%完成度
- 10小时内: 加上装饰器系统 → 95%完成度

建议从最简单的开始，快速提升完成度！
