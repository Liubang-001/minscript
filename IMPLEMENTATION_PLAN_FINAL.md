# 最终实现计划

按照从简单到复杂的顺序实现以下功能：

## 1. __contains__ 魔术方法（30分钟）

### 当前状态
- `in` 运算符仅用于 for 循环
- 没有作为二元运算符实现
- 没有 OP_IN 或 OP_CONTAINS 操作码

### 实现步骤
1. 添加 OP_IN 操作码
2. 在 parser.c 中将 TOKEN_IN 添加为二元运算符
3. 在 VM 中实现 OP_IN，支持 __contains__ 魔术方法
4. 测试

### 预计时间：30分钟

---

## 2. 字典推导式（1-2小时）

### 当前状态
- 列表推导式已实现
- 字典推导式未实现

### 实现步骤
1. 添加 OP_BUILD_DICT_COMP 操作码
2. 在 parser.c 中识别 `{k: v for ...}` 语法
3. 在 VM 中实现字典推导式逻辑
4. 测试

### 预计时间：1-2小时

---

## 3. Set类型（3-4小时）

### 当前状态
- 没有 set 类型
- 没有 set() 内置函数

### 实现步骤
1. 在 value.h 中定义 MS_VAL_SET
2. 创建 src/core/set.c 和 set.h
3. 实现 set 操作（add, remove, union, intersection等）
4. 添加 set() 内置函数
5. 实现集合推导式
6. 测试

### 预计时间：3-4小时

---

## 4. 装饰器系统（4-6小时）

### 当前状态
- TOKEN_AT 已添加
- 装饰器解析未实现

### 实现步骤
1. 在 parser.c 中解析 @ 语法
2. 实现装饰器应用机制
3. 实现 @property（getter/setter）
4. 实现 @classmethod
5. 实现 @staticmethod
6. 测试

### 预计时间：4-6小时

---

## 5. with语句（4-6小时）

### 当前状态
- TOKEN_WITH 已定义
- with 语句未实现

### 实现步骤
1. 添加 OP_WITH_BEGIN 和 OP_WITH_END 操作码
2. 在 parser.c 中解析 with 语句
3. 在 VM 中实现 __enter__ 和 __exit__ 调用
4. 测试

### 预计时间：4-6小时

---

## 6. 异常处理（8-12小时）

### 当前状态
- TOKEN_TRY, TOKEN_EXCEPT, TOKEN_FINALLY, TOKEN_RAISE 已定义
- 异常处理未实现

### 实现步骤
1. 定义异常对象系统
2. 添加异常处理操作码
3. 实现异常处理栈
4. 在 parser.c 中解析 try/except/finally
5. 在 VM 中实现异常传播和捕获
6. 实现内置异常类
7. 测试

### 预计时间：8-12小时

---

## 总时间估计：21-31.5小时

## 实现顺序
1. __contains__ (30分钟) ✓ 立即开始
2. 字典推导式 (1-2小时)
3. Set类型 (3-4小时)
4. 装饰器系统 (4-6小时)
5. with语句 (4-6小时)
6. 异常处理 (8-12小时)

## 完成后的状态
- 总体完成度：约 95%
- 核心功能：100%
- 高级功能：90%
- 低优先级功能：50%

这将使 MiniScript 成为一个非常完整和实用的 Python 解释器！
